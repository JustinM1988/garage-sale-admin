<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>OAuth 2.0 Callback</title>
  </head>
  <body>
    <!-- Load the ArcGIS JS AMD loader *in the popup* -->
    <script src="https://js.arcgis.com/4.29/"></script>
    <script>
      (function () {
        function closeSoon(){ setTimeout(function(){ try{ window.close(); }catch(_){} }, 60); }

        // Primary path: use AMD IdentityManager in the popup
        if (window.require) {
          window.require(["esri/identity/IdentityManager"], function (esriId) {
            try { esriId._oAuthCallback(window.location.href, window); } catch (e) {}
            closeSoon();
          });
          return;
        }

        // Fallbacks: try opener hooks (covers future/alt builds)
        try {
          var hooks = ["__esri_oauth_callback__", "__esri_rest_oauth_callback__"];
          for (var i=0;i<hooks.length;i++){
            var h = hooks[i];
            if (window.opener && typeof window.opener[h] === "function") {
              window.opener[h](window.location.href, window);
              return closeSoon();
            }
          }
        } catch(_) {}

        // Last resort: just close
        closeSoon();
      })();
    </script>
  </body>
</html>
