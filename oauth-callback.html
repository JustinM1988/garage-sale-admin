<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>OAuth 2.0 Callback</title>
</head>
<body>
<script>
/* Pass the OAuth response back to the opener's ArcGIS IdentityManager (ESM safe) */
(function () {
  function closeSoon(){ setTimeout(function(){ try{ window.close(); }catch(_){} }, 10); }

  try {
    if (window.opener) {
      // Preferred path for ESM apps: esriId was exposed on window by the opener
      if (window.opener.esriId && window.opener.esriId._oAuthCallback) {
        window.opener.esriId._oAuthCallback(window.location.href, window);
        return closeSoon();
      }
      // Fallback if opener used AMD/RequireJS
      if (window.opener.require) {
        window.opener.require(["esri/identity/IdentityManager"], function(esriId) {
          esriId._oAuthCallback(window.location.href, window);
          closeSoon();
        });
        return;
      }
    }
  } catch (e) {
    // ignore and just try to close
  }
  closeSoon();
})();
</script>
</body>
</html>
